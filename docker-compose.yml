version: '3.8'
services:

  nats-service:
    image: nats:latest
    volumes:
      - ./nats/config/:/etc/nats
    command: "-c /etc/nats/nats.conf " 
    # --routes=nats://ruser:T0pS3cr3t@nats:6222" # --cluster nats://0.0.0.0:6222 " # "
    ports:
      - 8222:8222 # http dashboard
      - 4222:4222 # regular clients
      - 9222:6222 # websockets
    # network_mode: host

  bun-chat:
    build:
      context: ./chat-app
      dockerfile: Dockerfile    
    #container_name: bun-chat-dev
    volumes:
      #- ../../:workspaces:cached 
      # - .:/workspace:cached
      # - ./chat-app:my-app/workspace/:cached
      - ./chat-app/:/workspaces/my-app:cached
      #- .:/my-app/workspace:cached
    environment:
      NODE_ENV: development
    ports:
      - 5000:5000 #http front-end
      - 3000:3000 #debug port
      # - 4223:4222 # nats port
    links:
      - nats-service
    #command: bun --bun run dev ./my-app/
    command: /bin/sh -c "while sleep 1000; do :; done"
    # network_mode: host